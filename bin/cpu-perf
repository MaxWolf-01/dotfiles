#!/usr/bin/env bash

echo "=== CPU Info ==="
lscpu | grep -E "Model name|Socket|Core|Thread|MHz|cache"

echo -e "\n=== Memory Bandwidth ==="
if command -v sysbench &>/dev/null; then
    sysbench memory --memory-block-size=1M --memory-total-size=10G run 2>/dev/null | grep -E "transferred|total time"
else
    echo "sysbench not installed"
fi

echo -e "\n=== NUMA Topology ==="
if command -v numactl &>/dev/null; then
    numactl --hardware
else
    echo "numactl not installed"
fi

echo -e "\n=== Memory Info ==="
free -h

echo -e "\n=== Single-core perf (quick) ==="
if command -v sysbench &>/dev/null; then
    sysbench cpu --cpu-max-prime=20000 --threads=1 run 2>/dev/null | grep -E "events per second|total time"
else
    echo "sysbench not installed"
fi

echo -e "\n=== Multi-core perf (quick) ==="
if command -v sysbench &>/dev/null; then
    sysbench cpu --cpu-max-prime=20000 --threads=$(nproc) run 2>/dev/null | grep -E "events per second|total time"
else
    echo "sysbench not installed"
fi

return {
  "folke/sidekick.nvim",
  enabled = false,
  opts = {
    cli = {
      mux = {
        enabled = false,  -- No tmux/zellij for now
      },
      win = {
        layout = "right",  -- Terminal on the right side
        split = {
          width = 80,  -- Reasonable width for AI responses
        },
      },
      prompts = {
        explain_diag = "Explain this diagnostic and how to fix it:\n{diagnostics}",
        diagnostics_all = "Can you help me fix these diagnostics?\n{diagnostics_all}",
        -- Context templates (no duplicate keybindings)
        buffers = "{buffers}",
        line = "{line}",
        position = "{position}",
        quickfix = "{quickfix}",
        ["function"] = "{function}",
        class = "{class}",
      },
    },
    signs = {
      icon = " ",  -- Matches your nerd font aesthetic
    },
    nes = {
      debounce = 100,  -- Standard responsiveness
      diff = {
        inline = "words",  -- Word-level diffs (can try "chars" for finer granularity)
      },
    },
  },
  keys = {
    -- NES is handled via blink.cmp Tab integration

    -- CLI Tools
    {
      "<leader>aa",
      function() require("sidekick.cli").toggle() end,
      desc = "Sidekick: Toggle AI CLI",
      mode = { "n", "x" },
    },
    {
      "<c-.>",
      function() require("sidekick.cli").toggle() end,
      desc = "Sidekick: Toggle AI CLI",
      mode = { "n", "t", "i", "x" },
    },
    {
      "<leader>as",
      function() require("sidekick.cli").select() end,
      desc = "Sidekick: Select AI tool",
    },
    {
      "<leader>ad",
      function() require("sidekick.cli").close() end,
      desc = "Sidekick: Detach session",
    },

    -- Context sending
    {
      "<leader>af",
      function() require("sidekick.cli").send({ msg = "{file}" }) end,
      desc = "Sidekick: Send file",
    },
    {
      "<leader>at",
      function() require("sidekick.cli").send({ msg = "{this}" }) end,
      desc = "Sidekick: Send this context",
      mode = { "n", "x" },
    },
    {
      "<leader>av",
      function() require("sidekick.cli").send({ msg = "{selection}" }) end,
      desc = "Sidekick: Send selection",
      mode = { "x" },
    },

    -- Prompt picker
    {
      "<leader>ap",
      function() require("sidekick.cli").prompt() end,
      desc = "Sidekick: Select prompt",
      mode = { "n", "x" },
    },
  },
}
